<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>MyFinBuddy INPUT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        margin: 0;
        padding: 16px;
        background: linear-gradient(180deg,#f7fbfb,#f0fcf8);
        color: #111827;
      }
      h3 {
        margin: 0 0 12px;
        font-size: 18px;
        text-align: center;
      }
      hcard {
        margin: 0 0 12px;
        font-size: 18px;
      }
      hp1 {
        margin: 0 0 10px;
        font-size: 16px;
        font-weight: bold;
      }
      hp2 {
        margin: 0 0 8px;
        font-size: 14px;
        font-weight: bold;
      }
      p{
        font-size: 14px;
        margin: 0 0 8px;
      }
      p.p-tight{
        font-size: 14px;
        margin: 0;
      }
      .app-shell {
        max-width: 480px;
        margin: 0 auto;
      }
      #userBar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        font-size: 12px;
        color: #6b7280;
      }
      #userBar span strong {
        color: #111827;
      }
      .badge {
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        background: #e5f3ff;
        color: #1d4ed8;
      }
      .screen {
        display: none;
        background: linear-gradient(180deg,#f7fbfb,#f0fcf8);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
      }
      .screen.active {
        display: block;
      }
      .home {
        text-align: center;
      }
      .btn {
        display: block;
        width: 100%;
        margin: 8px 0;
      }
      .btn img {
        width: 100%;
        border-radius: 999px;
        display: block;
      }
      .back {
        border: none;
        background: none;
        color: #4b5563;
        font-size: 14px;
        margin-bottom: 8px;
        cursor: pointer;
      }
      .header {
        margin-bottom: 12px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
      }
      .card-btn {
        border-radius: 12px;
        background: #fff;
        padding: 8px;
        text-align: center;
        cursor: pointer;
        border: 2px solid transparent;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
      }
      .card-btn img {
        width: 60%;
        height: 60%;
        object-fit: contain;
      }
      .card-btn .label {
        font-size: 12px;
        margin-top: 4px;
      }
      .card-btn.active {
        border-color: #06c755;
        background: #ecfdf3;
      }
      .form-section {
        margin-top: 16px;
      }
      .amount-row {
        display: flex;
        gap: 5px;
        align-items: center;
      }
      .selected-category {
        flex: 0 0 auto;
        min-width: 80px;
        font-size: 13px;
        color: #4b5563;
      }
      input[type="text"] {
        flex: 1;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #d1d5db;
        font-size: 14px;
      }
      .confirm-btn {
        width: 100%;
        margin-top: 16px;
        border: none;
        border-radius: 999px;
        padding: 10px 16px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        background: #06c755;
        color: white;
        box-shadow: 0 4px 10px rgba(6, 199, 85, 0.35);
      }
      .page.hidden {
        display: none;
      }
      .category-btn {
        border-radius: 999px;
        background: #fff;
        padding: 8px 12px;
        cursor: pointer;
        border: 2px solid transparent;
        font-size: 13px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .category-btn.active {
        border-color: #06c755;
        background: #ecfdf3;
      }
      .category-btn img {
        flex-shrink: 0;
        object-fit:contain;
      }
      .category-block {
        border-radius: 12px;
        background: #fff;
        padding: 10px;
        margin-bottom: 12px;
      }
      .category-block h3 {
        font-size: 14px;
        margin-bottom: 8px;
      }
      .card-content label {
        display: block;
        font-size: 12px;
        margin-top: 6px;
        margin-bottom: 2px;
      }
      .card-content input {
        width: 100%;
        border-radius: 999px;
        border: 1px solid #d1d5db;
        padding: 6px 10px;
        font-size: 13px;
      }
      .card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 8px;
        font-size: 12px;
      }
      .card-footer .actions button {
        border-radius: 999px;
        border: none;
        padding: 4px 8px;
        margin-left: 4px;
        cursor: pointer;
        background: #e5e7eb;
      }
      /* Mascot popup */
      #mascotBox {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.3);
        align-items: center;
        justify-content: center;
        z-index: 50;
      }
      #mascotInner {
        background: #fff;
        padding: 16px;
        border-radius: 16px;
        max-width: 320px;
        text-align: center;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
      }
      #mascotText {
        font-size: 14px;
        margin-top: 8px;
      }
      .mascot-img{
        width: 100%;
        object-fit: contain;
      }
      .checkbox{
        margin-top:15px;
        font-size:14px;
      }
      button:disabled{
        background:#aaa;
        cursor:not-allowed;
      }
      .field{
        margin-top:15px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
    </style>
  </head>
  <body onload="initializeLiff()">
    <div class="app-shell">
      <div id="userBar">
        <span><strong>User ID:</strong> <span id="userIdText">-</span></span>
        <span class="badge" id="envBadge">Loading...</span>
      </div>

      <!-- ================= Consent ================= -->
      <section id="consent" class="screen active">
        <div class="header">
          <hcard><b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personal Data Consent Form)</b></hcard>
        </div>
        <hp1>üîê ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</hp1>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÇ‡∏î‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:</p>
        <hp2>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö</hp2>
        <p class="p-tight">‚Ä¢ LINE User ID</p>
        <p class="p-tight">‚Ä¢ ‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
        <p class="p-tight">‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
        <p>‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</p>
        <hp2>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</hp2>
        <p class="p-tight">‚Ä¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        <p class="p-tight">‚Ä¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personalized Financial Advice)</p>
        <p class="p-tight">‚Ä¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (Financial Progress Tracking)</p>
        <p class="p-tight">‚Ä¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
        <p>‚Ä¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</p>
        <p><b>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</b> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
        <p><b>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</b> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏•‡∏≠‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</p>
        <p><b>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏≤‡∏° PDPA)</b> ‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£:</p>
        <p class="p-tight">‚Ä¢ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô</p>
        <p class="p-tight">‚Ä¢ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        <p class="p-tight">‚Ä¢ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        <p>‚Ä¢ ‡∏ñ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô</p>
        
        <p class="p-tight">
          üîó ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ) 
          <a href="https://external-form.com" target="_blank">
            https://external-form.com
          </a>
        </p>
        <p>‚Ä¢ ‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å"‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" ‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏≠‡∏µ‡∏Å ‡∏´‡∏≤‡∏Å‡∏•‡∏∑‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏ä‡∏ó‡∏°‡∏≤‡πÉ‡∏ô‡πÑ‡∏•‡∏ô‡πå "‡∏Ç‡∏≠‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å"</p>

        <div class="field">
          <label>‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
          <input type="text" id="employeeId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
        </div>
        
        <div class="checkbox">
          <input type="checkbox" id="consentCheckbox">
          <label for="consentCheckbox">
            <b>‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤</b>
          </label>
          <p>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô</p>
        </div>
        
        <button id="submitBtn" class="confirm-btn" onclick="submitConsent()" disabled>‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
      </section>

      <!-- ================= Initial Input ================= -->
      <section id="initial input" class="screen">
        <div class="field">
          <label>‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
          <input type="text" id="employeeId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
        </div>
      </section>
 
      <!-- ================= HOME ================= -->
      <section id="home" class="screen home">
        <h3>‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
 
        <button
          class="btn"
          onclick="goTo('income')"
          aria-label="Income"
          style="padding: 0; border: none; background: none"
        >
          <img
            src="https://sirikornngam.github.io/MyFinBuddy-images/Income_button.png"
            alt="Income"
            style="
              width: 100%;
              height: 100%;
              display: block;
              object-fit: cover;
              border-radius: 999px;
              pointer-events: none;
            "
          />
        </button>
 
        <button
          class="btn"
          onclick="goTo('expenses')"
          aria-label="Expenses"
          style="padding: 0; border: none; background: none"
        >
          <img
            src="https://sirikornngam.github.io/MyFinBuddy-images/Expenses_button.png"
            alt="Expenses"
            style="
              width: 100%;
              height: 100%;
              display: block;
              object-fit: cover;
              border-radius: 999px;
              pointer-events: none;
            "
          />
        </button>
 
        <button
          class="btn"
          onclick="goTo('debt')"
          aria-label="Debt"
          style="padding: 0; border: none; background: none"
        >
          <img
            src="https://sirikornngam.github.io/MyFinBuddy-images/Debt_button.png"
            alt="Debt"
            style="
              width: 100%;
              height: 100%;
              display: block;
              object-fit: cover;
              border-radius: 999px;
              pointer-events: none;
            "
          />
        </button>
      </section>
 
      <!-- ================= INCOME ================= -->
      <section id="income" class="screen">
        <button class="back" onclick="goTo('home')">‚Üê Back</button>
        <div class="header">
          <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞</h3>
        </div>
        <div class="grid">
          <div class="card-btn" onclick="selectCard(this, 'salary')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/salary.png"
            />
            <div class="label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (salary)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'bonus')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/bonus.png"
            />
            <div class="label">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ (bonus)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'freelance')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/freelance.png"
            />
            <div class="label">‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå/‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏° (freelance)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'profits/dividend')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/dividend.png"
            />
            <div class="label">‡∏Å‡∏≥‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô (profits/dividend)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'saving')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/saving.png"
            />
            <div class="label">‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° (saving)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'asset sale')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/asset sale.png"
            />
            <div class="label">‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (asset sale)</div>
          </div>
        </div>
        <div class="form-section">
          <div class="amount-row">
            <div id="selectedCategoryText_section1" class="selected-category">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            </div>
            <input
              type="text"
              id="amount_income"
              inputmode="numeric"
              placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"
            />
          </div>
        </div>
        <button class="confirm-btn" onclick="submitData('income')">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        </button>
      </section>
 
      <!-- ================= EXPENSES ================= -->
      <section id="expenses" class="screen">
        <button class="back" onclick="goTo('home')">‚Üê Back</button>
        <div class="header">
          <h3>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?</h3>
        </div>
        <div class="grid">
          <div class="card-btn" onclick="selectCard(this, 'food&drink')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/food&drink.png"
            />
            <div class="label">‡∏≠‡∏≤‡∏´‡∏≤‡∏£ &amp; ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</div>
            <div class="label">(food &amp; drink)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'travel')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/travel.png"
            />
            <div class="label">‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (travel)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'utilities')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/utilities.png"
            />
            <div class="label">‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü (utilities)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'housing')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/housing.png"
            />
            <div class="label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢ (housing)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'investment')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/investment.png"
            />
            <div class="label">‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô (investment)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'debt')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/debt payment.png"
            />
            <div class="label">‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ (debt)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'shopping/fashion')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/fashion.png"
            />
            <div class="label">‡∏ä‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á/‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏° (shopping)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'health/insurance')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/health.png"
            />
            <div class="label">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û/‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô (health/insurance)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'business/work')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/business.png"
            />
            <div class="label">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à/‡∏á‡∏≤‡∏ô (business/work)</div>
          </div>
 
          <div class="card-btn" onclick="selectCard(this, 'education')">
            <img
              src="https://sirikornngam.github.io/MyFinBuddy-images/education.png"
            />
            <div class="label">‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á (education)</div>
          </div>
        </div>
        <div class="form-section">
          <div class="amount-row">
            <div id="selectedCategoryText_section2" class="selected-category">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            </div>
            <input
              type="text"
              id="amount_expense"
              inputmode="numeric"
              placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"
            />
          </div>
        </div>
        <button class="confirm-btn" onclick="submitData('expense')">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        </button>
      </section>
 
      <!-- ================= DEBT ================= -->
      <section id="debt" class="screen">
        <button class="back" onclick="goTo('home')">‚Üê Back</button>
        <div class="header">
          <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏´‡∏°‡∏ß‡∏î)</h3>
        </div>
        <div id="pageSelect" class="page">
          <div class="grid">
            <div class="category-btn" onclick="toggleCategory(this, 'car')">
              <img
                src="https://sirikornngam.github.io/MyFinBuddy-images/car.png"
                alt="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå"
                style="width: 50px; height: 30px; vertical-align: middle"
              />
              ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå (car)
            </div>
            <div class="category-btn" onclick="toggleCategory(this, 'house')">
              <img
                src="https://sirikornngam.github.io/MyFinBuddy-images/house.png"
                alt="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢"
                style="width: 50px; height: 50px; vertical-align: middle"
              />
              ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢ (housing)
            </div>
            <div class="category-btn" onclick="toggleCategory(this, 'credit')">
              <img
                src="https://sirikornngam.github.io/MyFinBuddy-images/credit card.png"
                alt="‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï"
                style="width: 90px; height: 40px; vertical-align: middle"
              />
              ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (credit card)
            </div>
            <div
              class="category-btn"
              onclick="toggleCategory(this, 'personal')"
            >
              <img
                src="https://sirikornngam.github.io/MyFinBuddy-images/shopping.png"
                alt="‡∏ú‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"
                style="width: 50px; height: 50px; vertical-align: middle"
              />
              ‡∏ú‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (shopping)
            </div>
            <div class="category-btn" onclick="toggleCategory(this, 'credit')">
              <img
                src="https://sirikornngam.github.io/MyFinBuddy-images/bank.png"
                alt="‡∏Å‡∏π‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£"
                style="width: 40px; height: 40px; vertical-align: middle"
              />
              ‡∏Å‡∏π‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (banking)
            </div>
            <div
              class="category-btn"
              onclick="toggleCategory(this, 'personal')"
            >
              <img
                src="https://sirikornngam.github.io/MyFinBuddy-images/‡∏´‡∏ô‡∏µ‡πâ‡∏ô‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö.png"
                alt="‡∏´‡∏ô‡∏µ‡πâ‡∏ô‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"
                style="width: 40px; height: 40px; vertical-align: middle"
              />
              ‡∏´‡∏ô‡∏µ‡πâ‡∏ô‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (personal)
            </div>
          </div>
        </div>
 
        <!-- ================= wizard ================= -->
        <div id="pageWizard" class="page hidden"></div>
 
        <button class="confirm-btn" onclick="handleDebtConfirm()">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        </button>
      </section>
    </div>
 
    <!-- Mascot popup -->
    <div id="mascotBox">
      <div id="mascotInner">
        <img src="https://sirikornngam.github.io/MyFinBuddy-images/data saved.png" class="mascot-img">
        <div id="mascotText"></div>
      </div>
    </div>
 
    <!-- LIFF SDK + App logic -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      let LINE_USER_ID = "";
 
      // Your LIFF ID
      const LIFF_ID = "2009000080-KQi3gBOi";
      // Server to receive JWT (optional, adjust or remove if not needed)
      const SERVER_URL = "https://sirikornngam.github.io/MyFinBuddy_line-system/test.html";
 
      async function initializeLiff() {
        const envBadge = document.getElementById("envBadge");
        const userIdText = document.getElementById("userIdText");
 
        try {
          if (typeof liff === "undefined") {
            envBadge.textContent = "Error";
            console.error("LIFF SDK failed to load");
            return;
          }
 
          await liff.init({
            liffId: LIFF_ID,
            withLoginOnExternalBrowser: true,
          });
 
          envBadge.textContent = liff.isInClient()
            ? "LINE App"
            : "External Browser";
 
          if (!liff.isLoggedIn()) {
            // Redirect back to this page after login (works in external browser)
            liff.login({ redirectUri: window.location.href });
            return;
          }
 
          const decoded = liff.getDecodedIDToken();
          if (!decoded) {
            console.error("No decoded ID token. Check OpenID scope.");
            return;
          }
 
          LINE_USER_ID = decoded.sub;
          userIdText.textContent = LINE_USER_ID;

          checkConsentStatus(LINE_USER_ID);
 
          // Optional: also send raw JWT + userId to your server
          const rawIdToken = liff.getIDToken();
          if (rawIdToken) {
            try {
              await fetch(SERVER_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  idToken: rawIdToken,
                  userId: LINE_USER_ID,
                }),
              });
            } catch (err) {
              console.warn("Failed to send JWT to server:", err);
            }
          }
        } catch (err) {
          console.error("LIFF init error", err);
          envBadge.textContent = "Error";
        }
      }
 
      /* ---------- Navigation logic ---------- */
      function showScreen(id) {
        document
          .querySelectorAll(".screen")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");
      }
 
      function goTo(screen) {
        history.pushState({ screen }, "", "");
        showScreen(screen);
      }
 
      window.addEventListener("popstate", (e) => {
        if (e.state && e.state.screen) {
          showScreen(e.state.screen);
        } else {
          showScreen("home");
        }
      });

      /* ===== CHECK CONSENT ===== */
      async function checkConsentStatus(userId){
        try{
          const res = await fetch(`${"https://script.google.com/macros/s/AKfycbywlUADdisrqUB54D0vSaD-2R3VoMPqdaWX_3wwA-i6pdkHBPhlGCWjQUZsD-wyMuM/exec"}?line_user_id=${userId}`);
          const result = await res.json();
      
          if(result.consented === true){
            console.log("Already consented");
            goTo("home");   // üëâ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ home
          }else{
            goTo("consent"); // üëâ ‡πÅ‡∏™‡∏î‡∏á consent
          }
      
        }catch(err){
          console.error("Consent check error", err);
          goTo("consent");
        }
      }
      
      /* ===== UI LOGIC ===== */
      const checkbox = document.getElementById("consentCheckbox");
      const btn = document.getElementById("submitBtn");
      
      checkbox.addEventListener("change", ()=>{
        btn.disabled = !checkbox.checked;
      });
      
      /* ===== SUBMIT CONSENT ===== */
      async function submitConsent(){

        const employeeId = document.getElementById("employeeId").value.trim();

        if(!employeeId){
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
          return;
        }
      
        if(!checkbox.checked){
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
          return;
        }
      
        const payload = {
          line_user_id: LINE_USER_ID,
          employee_id: employeeId,
          consent: true,
          consent_version: "v1.0",
          timestamp: new Date().toISOString(),
          source: "LIFF"
        };
      
        try{
          const res = await fetch("https://script.google.com/macros/s/AKfycbywlUADdisrqUB54D0vSaD-2R3VoMPqdaWX_3wwA-i6pdkHBPhlGCWjQUZsD-wyMuM/exec",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify(payload)
          });
      
          const result = await res.json();
      
          if(result.status === "success"){
            console.log("Consent saved");
            goTo("home");  // üëâ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ home ‡∏´‡∏•‡∏±‡∏á‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°
          }else{
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          }
      
        }catch(err){
          console.error(err);
          alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          goTo("home");
        }
      }

      /* =========================
         Income & Expense logic
      ========================= */
      let selectedCategory = "";
 
      function selectCard(element, category) {
        document
          .querySelectorAll(".card-btn")
          .forEach((btn) => btn.classList.remove("active"));
 
        element.classList.add("active");
        selectedCategory = category;
 
        const sec1 = document.getElementById("selectedCategoryText_section1");
        const sec2 = document.getElementById("selectedCategoryText_section2");
        if (sec1) sec1.textContent = category + " :";
        if (sec2) sec2.textContent = category + " :";
 
        // focus appropriate input
        const incomeInput = document.getElementById("amount_income");
        const expenseInput = document.getElementById("amount_expense");
        if (
          incomeInput &&
          document.getElementById("income").classList.contains("active")
        ) {
          incomeInput.focus();
        } else if (
          expenseInput &&
          document.getElementById("expenses").classList.contains("active")
        ) {
          expenseInput.focus();
        }
      }
 
      // Format money with comma
      function attachAmountFormatter(id) {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("input", function () {
          let value = this.value.replace(/,/g, "");
          if (value === "") return;
          if (!isNaN(value)) {
            this.value = Number(value).toLocaleString("en-US");
          }
        });
      }
 
      attachAmountFormatter("amount_income");
      attachAmountFormatter("amount_expense");
 
      function submitData(type) {
        const input = document.getElementById(`amount_${type}`);
        if (!input) return;
 
        let rawAmount = input.value.replace(/,/g, "");
 
        if (!selectedCategory) {
          alert(
            `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà${
              type === "income" ? "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö" : "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢"
            }‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞`,
          );
          return;
        }
 
        if (!rawAmount || rawAmount <= 0) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
          return;
        }
 
        const payload = {
          type: type,
          category: selectedCategory,
          amount: rawAmount,
          userId: LINE_USER_ID,
        };
 
        // Mascot message
        showMascotMessage(
          `‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ${
            type === "income" ? "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö" : "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢"
          }‡∏à‡∏≤‡∏Å "${selectedCategory}" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${Number(
            rawAmount,
          ).toLocaleString()} ‡∏ö‡∏≤‡∏ó`,
        );
 
        // Send to Google Sheet
        fetch(
          "https://script.google.com/macros/s/AKfycbywlUADdisrqUB54D0vSaD-2R3VoMPqdaWX_3wwA-i6pdkHBPhlGCWjQUZsD-wyMuM/exec",
          {
            method: "POST",
            body: JSON.stringify(payload),
          },
        )
          .then((res) => res.text())
          .then(() => {
            setTimeout(() => {
              resetForm("income");
              resetForm("expense");
            }, 1500);
          })
          .catch((err) => {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ùå");
            console.error(err);
          });
      }
 
      /* =========================
         Mascot Popup
      ========================= */
      function showMascotMessage(message) {
        const box = document.getElementById("mascotBox");
        const text = document.getElementById("mascotText");
        if (!box || !text) return;
 
        text.innerText = message;
        box.style.display = "flex";
 
        setTimeout(() => {
          box.style.display = "none";
        }, 3000);
      }
 
      /* =========================
         Reset form
      ========================= */
      function resetForm(type) {
        selectedCategory = "";
 
        const input = document.getElementById(`amount_${type}`);
        if (input) input.value = "";
 
        const sec1 = document.getElementById("selectedCategoryText_section1");
        const sec2 = document.getElementById("selectedCategoryText_section2");
        if (sec1) sec1.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å";
        if (sec2) sec2.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å";
 
        document
          .querySelectorAll(".card-btn")
          .forEach((btn) => btn.classList.remove("active"));
      }
 
      /* =========================
         Debt wizard
      ========================= */
      let selectedCategories = [];
      const wizardData = {};
 
      function toggleCategory(el, cat) {
        if (selectedCategories.includes(cat)) {
          selectedCategories = selectedCategories.filter((c) => c !== cat);
          el.classList.remove("active");
        } else {
          selectedCategories.push(cat);
          el.classList.add("active");
        }
      }
 
      const categoryLabel = {
        car: "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå üöó",
        house: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢ üè†",
        credit: "‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï üí≥",
        shopping: "‡∏ú‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ üõçÔ∏è",
        banking: "‡∏Å‡∏π‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ üè¶",
        personal: "‡∏´‡∏ô‡∏µ‡πâ‡∏ô‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö üë§",
      };
 
      function renderCard(cat) {
        const d = wizardData[cat];
        const c = d.cards[d.currentIndex];
 
        document.getElementById(`${cat}-card`).innerHTML = `
          <label>‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô/‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô)</label>
          <input value="${c.render || ""}"
            oninput="updateValue('${cat}','render',this.value)">
          <label>‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
          <input value="${c.monthly || ""}"
            oninput="updateValue('${cat}','monthly',this.value)">
          <label>‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢</label>
          <input value="${c.remaining || ""}"
            oninput="updateValue('${cat}','remaining',this.value)">
          <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà 1 = ‡∏ö‡πâ‡∏≤‡∏ô1)</label>
          <input value="${c.note || ""}"
            oninput="updateValue('${cat}','note',this.value)">
        `;
 
        document.getElementById(`${cat}-progress`).innerText = `${
          d.currentIndex + 1
        } / ${d.cards.length}`;
      }
 
      function initWizard() {
        const container = document.getElementById("pageWizard");
        container.innerHTML = "";
 
        selectedCategories.forEach((cat) => {
          wizardData[cat] = {
            category: cat,
            userId: LINE_USER_ID,
            currentIndex: 0,
            cards: [{ render: "", monthly: "", remaining: "", note: "" }],
          };
 
          container.innerHTML += `
            <div class="category-block">
              <hcard>${categoryLabel[cat] || cat}</hcard>
              <div class="card-content" id="${cat}-card"></div>
              <div class="card-footer">
                <span class="progress" id="${cat}-progress"></span>
                <div class="actions">
                  <button onclick="addCard('${cat}')">Ôºã</button>
                  <button onclick="nextCard('${cat}')">‚ñ∂</button>
                </div>
              </div>
            </div>
          `;
 
          renderCard(cat);
        });
      }
 
      function goWizard() {
        if (selectedCategories.length === 0) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏´‡∏°‡∏ß‡∏î");
          return;
        }
 
        document.getElementById("pageSelect").classList.add("hidden");
        document.getElementById("pageWizard").classList.remove("hidden");
 
        initWizard();
      }
 
      function handleDebtConfirm() {
        const pageSelect = document.getElementById("pageSelect");
        const pageWizard = document.getElementById("pageWizard");
 
        // ‡∏´‡∏ô‡πâ‡∏≤ 1 ‚Üí ‡πÑ‡∏õ wizard
        if (!pageSelect.classList.contains("hidden")) {
          goWizard();
          return;
        }
 
        // ‡∏´‡∏ô‡πâ‡∏≤ 2 ‚Üí submit debt
        submitDebt();
      }
 
      function submitDebt() {
        const payload = {};
        Object.keys(wizardData).forEach((cat) => {
          payload[cat] = wizardData[cat].cards.map((card) => ({
            lender: card.render,
            monthly: Number(card.monthly),
            remaining: Number(card.remaining),
            note: card.note,
          }));
        });
 
        const body = {
          type: "debt",
          payload: payload,
          userId: LINE_USER_ID,
        };
 
        fetch(
          "https://script.google.com/macros/s/AKfycbywlUADdisrqUB54D0vSaD-2R3VoMPqdaWX_3wwA-i6pdkHBPhlGCWjQUZsD-wyMuM/exec",
          {
            method: "POST",
            body: JSON.stringify(body),
          },
        )
          .then((res) => res.text())
          .then(() => {
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
            goTo("home");
          })
          .catch((err) => {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ùå");
            console.error(err);
          });
      }
 
      function addCard(cat) {
        wizardData[cat].cards.push({
          render: "",
          monthly: "",
          remaining: "",
          note: "",
        });
        wizardData[cat].currentIndex = wizardData[cat].cards.length - 1;
        renderCard(cat);
      }
 
      function nextCard(cat) {
        const d = wizardData[cat];
        d.currentIndex = (d.currentIndex + 1) % d.cards.length;
        renderCard(cat);
      }
 
      function updateValue(cat, key, val) {
        wizardData[cat].cards[wizardData[cat].currentIndex][key] = val;
      }
    </script>
  </body>
</html>


















































